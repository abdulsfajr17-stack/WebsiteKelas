<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Website Kelas XI-2</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f1f5f9;
      background-image: radial-gradient(#cbd5e1 0.5px, transparent 0.5px);
      background-size: 15px 15px;
    }
    .section { display: none; animation: fadeIn 0.5s ease-in-out; }
    .section.active { display: block; }
    #beranda.active {
        display: flex;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .nav-link.active { background-color: #4A5568; color: white; }
    .info-tab-content { display: none; }
    .info-tab-content.active { display: block; animation: fadeIn 0.5s ease-in-out; }
    .info-tab-link.active { color: #2563EB; border-color: #2563EB; background-color: #DBEAFE; }
    .modal {
      display: none; position: fixed; z-index: 100;
      left: 0; top: 0; width: 100%; height: 100%; overflow: auto;
      background-color: rgba(0,0,0,0.5); 
      animation: fadeIn 0.3s;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 90%;
        max-width: 400px;
        border-radius: 10px;
        text-align: center;
    }
    .close-btn {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    .blog-content { white-space: pre-wrap; }
  </style>
</head>
<body class="bg-slate-100 p-4 md:p-6">

  <!-- Header -->
  <header class="bg-slate-200 rounded-xl shadow-lg p-4 mb-6 flex justify-between items-center sticky top-4 z-50">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Eltwogetheer</h1>
    <nav class="hidden sm:flex space-x-1">
      <a href="#" class="nav-link active px-4 py-2 rounded-lg font-semibold text-gray-600 hover:bg-slate-300 transition-all duration-300" onclick="showSection('beranda')">Beranda</a>
      <a href="#" class="nav-link px-4 py-2 rounded-lg font-semibold text-gray-600 hover:bg-slate-300 transition-all duration-300" onclick="showSection('informasi')">Informasi Kelas</a>
      <a href="#" class="nav-link px-4 py-2 rounded-lg font-semibold text-gray-600 hover:bg-slate-300 transition-all duration-300" onclick="showSection('blog')">Blog</a>
    </nav>
    <div id="auth-container">
      <button id="login-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg hover:-translate-y-0.5">
        Masuk
      </button>
      <div id="user-info" class="hidden items-center">
        <p id="user-email-display" class="text-sm text-gray-600 mr-4 font-medium"></p>
        <button id="logout-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg hover:-translate-y-0.5">
          Keluar
        </button>
      </div>
    </div>
  </header>

  <!-- Navigasi Mobile -->
        <nav class="sm:hidden bg-slate-200 rounded-xl shadow-md p-2 mb-6">
            <div class="flex justify-around">
                <a href="#" class="nav-link active flex-1 text-center px-2 py-2 rounded-lg font-semibold text-gray-600" onclick="showSection('beranda')">Beranda</a>
                <a href="#" class="nav-link flex-1 text-center px-2 py-2 rounded-lg font-semibold text-gray-600" onclick="showSection('informasi')">Informasi</a>
                <a href="#" class="nav-link flex-1 text-center px-2 py-2 rounded-lg font-semibold text-gray-600" onclick="showSection('blog')">Blog</a>
            </div>
        </nav>

        <!-- Konten Utama -->
        <main>
            <!-- Beranda -->
            <section id="beranda" class="section active relative text-white p-8 rounded-xl shadow-2xl text-center flex flex-col justify-center items-center min-h-[80vh] overflow-hidden" style="background-image: url('https://i.ibb.co.com/MxkMvtDd/525499349-17844268650540591-4431986960777497209-n.jpg'); background-size: cover; background-position: center;">
                <div class="absolute inset-0 bg-black bg-opacity-60 rounded-xl"></div>
                <div class="relative z-10">
                    <img src="https://i.ibb.co.com/MxkMvtDd/525499349-17844268650540591-4431986960777497209-n.jpg" alt="Foto Profil Kelas" class="w-36 h-36 rounded-full mx-auto mb-6 border-4 border-slate-400 object-cover shadow-lg">
                    <h2 class="text-4xl lg:text-5xl font-bold mb-2">Selamat Datang di Website Kelas XI-2</h2>
                    <p class="text-lg text-slate-200 max-w-3xl mx-auto">
                        Ini adalah ruang digital kami, tempat kami berbagi cerita, informasi, dan kenangan. Kami adalah angkatan yang solid, kreatif, dan penuh semangat untuk meraih masa depan. Jelajahi website kami untuk mengenal kami lebih dekat!
                    </p>
                </div>
            </section>


   <!-- Informasi Kelas -->
    <section id="informasi" class="section bg-white/80 backdrop-blur-sm p-8 rounded-xl shadow-lg mt-6">
        <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Informasi Kelas</h2>
        <div class="flex flex-wrap justify-center mb-6 bg-slate-100 rounded-lg p-1">
            <button class="info-tab-link active flex-1 px-4 py-2 font-semibold border-b-2 rounded-md transition-all duration-300" onclick="showInfoTab('struktur')">Struktur</button>
            <button class="info-tab-link flex-1 px-4 py-2 font-semibold border-b-2 border-transparent rounded-md transition-all duration-300" onclick="showInfoTab('kesepakatan')">Kesepakatan</button>
            <button class="info-tab-link flex-1 px-4 py-2 font-semibold border-b-2 border-transparent rounded-md transition-all duration-300" onclick="showInfoTab('piket')">Jadwal Piket</button>
            <button class="info-tab-link flex-1 px-4 py-2 font-semibold border-b-2 border-transparent rounded-md transition-all duration-300" onclick="showInfoTab('pelajaran')">Jadwal Pelajaran</button>
        </div>
        
        <!-- Konten Struktur -->
         <div id="struktur" class="info-tab-content active">
                    <h3 class="text-2xl font-semibold mb-8 text-gray-800 text-center">Struktur Organisasi Kelas</h3>
                    <div class="flex flex-col items-center text-center space-y-8">
                        <!-- Wali Kelas -->
                        <div class="bg-white p-4 rounded-lg shadow-lg border-t-4 border-blue-500 w-72">
                            <h4 class="font-bold text-lg text-blue-600">Wali Kelas</h4>
                            <p class="text-gray-700">Agus Iwan Kurniawan, S.Pd.</p>
                        </div>
                        
                        <!-- KM & Wakil -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-2xl">
                            <div class="bg-white p-4 rounded-lg shadow-lg border-t-4 border-green-500"><h4 class="font-bold text-lg text-green-600">Ketua Murid</h4><p class="text-gray-700">Abdul Fajri</p></div>
                            <div class="bg-white p-4 rounded-lg shadow-lg border-t-4 border-green-500"><h4 class="font-bold text-lg text-green-600">Wakil Ketua</h4><p class="text-gray-700">M Alvatar Agna K</p></div>
                        </div>

                        <!-- Sekretaris & Bendahara -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-2xl">
                            <div class="bg-white p-4 rounded-lg shadow-lg border-t-4 border-yellow-500"><h4 class="font-bold text-lg text-yellow-600">Sekretaris</h4><p class="text-gray-700">Sabrina Salwa Assyifa</p><p class="text-gray-700">Nadin Ayu Ramadhani</p></div>
                            <div class="bg-white p-4 rounded-lg shadow-lg border-t-4 border-yellow-500"><h4 class="font-bold text-lg text-yellow-600">Bendahara</h4><p class="text-gray-700">Carla Gendis Aptadewi J</p><p class="text-gray-700">Adhelia Anastasya</p></div>
                        </div>
                        
                        <!-- Siswa -->
                        <div class="w-full max-w-4xl text-center pt-4">
                            <h4 class="font-bold text-lg text-gray-800 mb-4">Anggota Kelas</h4>
                            <div class="grid sm:grid-cols-2 gap-x-8 gap-y-4 text-left bg-white p-6 rounded-lg shadow-lg">
                                <!-- Kolom 1 -->
                                <ul class="space-y-2">
                                    <li class="text-gray-700">Abdul Fajri</li><li class="text-gray-700">Adelia Sanuya Nidya Iftinah</li><li class="text-gray-700">Adhelia Anastasya</li><li class="text-gray-700">Amri Muhammad Fathirrahman Hilmi</li><li class="text-gray-700">Andhika Aflah Dhiaurrahman</li><li class="text-gray-700">Arrumaisha Yasmine Az-zahra</li><li class="text-gray-700">Arvica Joice Azalia</li><li class="text-gray-700">Bidadari Yumna Fariha</li><li class="text-gray-700">Carla Gendis Aptadewi Jatmiko</li><li class="text-gray-700">Charlene Ninditya Rahayu</li><li class="text-gray-700">Cinta Ermaulita Tambunan</li><li class="text-gray-700">Dzhahir Ar-razzi Anugrah</li><li class="text-gray-700">Filia Raisya Kayana</li><li class="text-gray-700">Kania Najjini</li><li class="text-gray-700">Manggali Dzakiyah Talita Sakhi</li><li class="text-gray-700">Mazaya Alya Thahira</li><li class="text-gray-700">Mohamad Azzam Handyan Wibowo</li><li class="text-gray-700">Muhamad Alvatar Agna Kautsar</li>
                                </ul>
                                <!-- Kolom 2 -->
                                <ul class="space-y-2">
                                    <li class="text-gray-700">Muhammad Fahri Akbar</li><li class="text-gray-700">Muhammad Nazril Maulana Yusuf</li><li class="text-gray-700">Muhammad Rizky Firdaus</li><li class="text-gray-700">Nabila Altoufunnisa</li><li class="text-gray-700">Nadin Ayu Ramadhani</li><li class="text-gray-700">Nailah Rizqya Lathifah</li><li class="text-gray-700">Narayan Wizard Januarezky</li><li class="text-gray-700">Nayla Kanisha Alshafa</li><li class="text-gray-700">Nayla Muqowwamatunnisa</li><li class="text-gray-700">Nazwa Juliana Putri</li><li class="text-gray-700">Nizar Ghaisan Hilman</li><li class="text-gray-700">Quina Mecca Al-musiqa</li><li class="text-gray-700">Raden Rezvan Miftahurrizki Djaya Soe</li><li class="text-gray-700">Ridho Aditya Putra</li><li class="text-gray-700">Rini</li><li class="text-gray-700">Sabrina Salwa Assyifa</li><li class="text-gray-700">Surya Pantura Marbun</li><li class="text-gray-700">Yulan Nur Aeni</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
        
        <!-- Konten Kesepakatan -->
        <div id="kesepakatan" class="info-tab-content">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800 text-center">Kesepakatan Kelas</h3>
            <div class="grid md:grid-cols-2 gap-4 text-left">
                <div class="bg-white/60 p-4 rounded-lg flex items-start space-x-3"><svg class="w-6 h-6 text-green-500 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><p class="text-gray-700">Datang tepat waktu sebelum bel berbunyi.</p></div>
                <div class="bg-white/60 p-4 rounded-lg flex items-start space-x-3"><svg class="w-6 h-6 text-green-500 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><p class="text-gray-700">Menjaga kebersihan dan ketertiban kelas.</p></div>
            </div>
        </div>

        <!-- Konten Jadwal Piket -->
        <div id="piket" class="info-tab-content">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800 text-center">Jadwal Piket Kebersihan</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-gray-300 rounded-lg shadow-md">
                    <thead class="bg-slate-100">
                        <tr><th class="py-3 px-4 border-b">Senin</th><th class="py-3 px-4 border-b">Selasa</th><th class="py-3 px-4 border-b">Rabu</th><th class="py-3 px-4 border-b">Kamis</th><th class="py-3 px-4 border-b">Jumat</th></tr>
                    </thead>
                    <tbody>
                        <tr class="text-gray-700 text-center">
                            <td class="p-3 border-b align-top"><ul class="list-none space-y-1"><li>Cinta</li><li>Filia</li><li>Mazaya</li><li>Nazril</li><li>Nizar</li><li>Surya</li><li>Yumna</li></ul></td>
                            <td class="p-3 border-b align-top"><ul class="list-none space-y-1"><li>Ade</li><li>Andhika</li><li>Carla</li><li>Dzahir</li><li>Nadin</li><li>Sabrina</li><li>Yulan</li></ul></td>
                            <td class="p-3 border-b align-top"><ul class="list-none space-y-1"><li>Adhel</li><li>Fahri</li><li>Nabila</li><li>Nailah</li><li>Narayan</li><li>Ridho</li><li>Rizky</li></ul></td>
                            <td class="p-3 border-b align-top"><ul class="list-none space-y-1"><li>Arum</li><li>Azzam</li><li>Fathir</li><li>Manggali</li><li>Nayla K</li><li>Nindi</li><li>Rini</li></ul></td>
                            <td class="p-3 border-b align-top"><ul class="list-none space-y-1"><li>Abdul</li><li>Alvatar</li><li>Joice</li><li>Kania</li><li>Nayla M</li><li>Nazwa</li><li>Quina</li><li>Rezvan</li></ul></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Konten Jadwal Pelajaran -->
                <div id="pelajaran" class="info-tab-content">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-800 text-center">Jadwal Pelajaran</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-300 rounded-lg shadow-md">
                            <thead class="bg-slate-100">
                                <tr><th class="py-3 px-4 border-b">Senin</th><th class="py-3 px-4 border-b">Selasa</th><th class="py-3 px-4 border-b">Rabu</th><th class="py-3 px-4 border-b">Kamis</th><th class="py-3 px-4 border-b">Jumat</th></tr>
                            </thead>
                            <tbody class="text-center text-gray-700 text-sm">
                                <tr><td class="py-2 px-4 border-b">Matwa</td><td class="py-2 px-4 border-b">Pjok</td><td class="py-2 px-4 border-b">Biologi</td><td class="py-2 px-4 border-b">Biologi</td><td class="py-2 px-4 border-b">B. Jepang</td></tr>
                                <tr><td class="py-2 px-4 border-b">Matwa</td><td class="py-2 px-4 border-b">Pjok</td><td class="py-2 px-4 border-b">Biologi</td><td class="py-2 px-4 border-b">Biologi</td><td class="py-2 px-4 border-b">B. Jepang</td></tr>
                                <tr><td class="py-2 px-4 border-b">Seni Budaya</td><td class="py-2 px-4 border-b">B. Jepang</td><td class="py-2 px-4 border-b">Sejarah</td><td class="py-2 px-4 border-b">Biologi</td><td class="py-2 px-4 border-b">Matwa</td></tr>
                                <tr><td class="py-2 px-4 border-b">Seni Budaya</td><td class="py-2 px-4 border-b">B. Jepang</td><td class="py-2 px-4 border-b">Sejarah</td><td class="py-2 px-4 border-b">Kimia</td><td class="py-2 px-4 border-b">Matwa</td></tr>
                                <tr><td class="py-2 px-4 border-b">Pai</td><td class="py-2 px-4 border-b">B. Jepang</td><td class="py-2 px-4 border-b">BK</td><td class="py-2 px-4 border-b">Kimia</td><td class="py-2 px-4 border-b">Ppkn</td></tr>
                                <tr><td class="py-2 px-4 border-b">Pai</td><td class="py-2 px-4 border-b">Matlan</td><td class="py-2 px-4 border-b">B. Inggris</td><td class="py-2 px-4 border-b">B. Indonesia</td><td class="py-2 px-4 border-b">Ppkn</td></tr>
                                <tr><td class="py-2 px-4 border-b">Pai</td><td class="py-2 px-4 border-b">Matlan</td><td class="py-2 px-4 border-b">B. Inggris</td><td class="py-2 px-4 border-b">B. Indonesia</td><td class="py-2 px-4 border-b">B. Indonesia</td></tr>
                                <tr><td class="py-2 px-4 border-b">B. Sunda</td><td class="py-2 px-4 border-b">Matlan</td><td class="py-2 px-4 border-b">B. Inggris</td><td class="py-2 px-4 border-b">Matlan</td><td class="py-2 px-4 border-b">B. Indonesia</td></tr>
                                <tr><td class="py-2 px-4 border-b">B. Sunda</td><td class="py-2 px-4 border-b">Fisika</td><td class="py-2 px-4 border-b">Kimia</td><td class="py-2 px-4 border-b">Matlan</td><td class="py-2 px-4 border-b"></td></tr>
                                <tr><td class="py-2 px-4 border-b">B. Sunda</td><td class="py-2 px-4 border-b">Fisika</td><td class="py-2 px-4 border-b">Kimia</td><td class="py-2 px-4 border-b">Fisika</td><td class="py-2 px-4 border-b"></td></tr>
                                <tr><td class="py-2 px-4 border-b"></td><td class="py-2 px-4 border-b">Fisika</td><td class="py-2 px-4 border-b">Kimia</td><td class="py-2 px-4 border-b">Fisika</td><td class="py-2 px-4 border-b"></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

  <!-- Blog Section -->
  <section id="blog" class="section bg-white/80 backdrop-blur-sm p-8 rounded-xl shadow-lg mt-6">
    <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Blog Kelas</h2>
    
    <div id="blog-form-container" class="hidden mb-8 bg-slate-50 p-6 rounded-lg shadow-inner">
      <h3 class="text-xl font-semibold mb-2">Tulis Blog Baru</h3>
      <input id="blog-title" type="text" placeholder="Judul" class="border rounded p-2 w-full mb-2" />
      <textarea id="blog-content" placeholder="Isi postingan..." class="border rounded p-2 w-full mb-2"></textarea>
      <button id="submit-blog" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full">Kirim</button>
    </div>

    <div id="blog-posts" class="space-y-4">
        <p class="text-center text-gray-500">Memuat postingan...</p>
    </div>
  </section>

  <!-- Footer -->
        <footer class="text-center mt-8 text-gray-600">
            <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-md p-4 flex justify-center items-center space-x-6">
                <a href="https://www.instagram.com/eltwogetheer/" target="_blank" class="flex items-center space-x-2 text-gray-600 hover:text-pink-600 transition-all duration-300 transform hover:scale-110"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg><span>Instagram Kelas</span></a>
                <a href="https://whatsapp.com/channel/0029Vb6MNnsK5cDEWCX0qv2X" target="_blank" class="flex items-center space-x-2 text-gray-600 hover:text-green-600 transition-all duration-300 transform hover:scale-110">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19.1 4.9C17.2 3 14.7 2 12 2C6.5 2 2 6.5 2 12c0 1.8.5 3.5 1.3 5L2.2 22l5.3-1.4c1.5.8 3.1 1.2 4.7 1.2h.1c5.5 0 10-4.5 10-10c0-2.7-1-5.2-2.9-7.1zm-7.1 15.2c-1.6 0-3.2-.5-4.5-1.3l-.3-.2-3.4.9.9-3.3-.2-.3c-.8-1.4-1.2-3-1.2-4.6c0-4.1 3.3-7.4 7.4-7.4c2 0 3.9.8 5.3 2.2c1.4 1.4 2.2 3.3 2.2 5.3c0 4.1-3.3 7.4-7.4 7.4zm4.5-5.5c-.2-.1-1.5-.7-1.7-.8s-.4-.1-.6.1s-.6.8-.8.9c-.2.1-.3.2-.5.1c-.2-.1-1.1-.4-2-1.2c-.8-.7-1.3-1.5-1.4-1.8c-.1-.2 0-.4.1-.5s.2-.3.4-.4c.1-.1.2-.2.2-.4c.1-.1 0-.3-.1-.4s-.6-1.3-.8-1.8c-.2-.5-.4-.4-.5-.4h-.5c-.2 0-.4.1-.6.3s-.8.8-.8 1.9s.8 2.2.9 2.3c.1.1 1.5 2.4 3.7 3.3c.5.2.9.4 1.2.5c.5.2 1 .1 1.4-.1c.4-.2 1.5-.6 1.7-1.2c.2-.5.2-1 .1-1.1s-.2-.2-.4-.3z"/>
            </svg>
            <span>Saluran WhatsApp</span></a>
            </div>
            <p class="mt-4 text-sm">&copy; 2025 KELAS XI-2 SMA NEGERI 12 BANDUNG.</p>
        </footer>
    </div>

  <!-- Modal Login -->
  <div id="login-modal" class="modal">
    <div class="modal-content">
      <span id="close-login-modal-btn" class="close-btn">&times;</span>
      <h3 class="text-2xl font-bold mb-4">Login</h3>
      <p id="login-error" class="text-red-500 text-sm mb-4 hidden"></p>
      <input id="email-input" type="email" placeholder="Email" class="border rounded p-2 w-full mb-4">
      <input id="password-input" type="password" placeholder="Password" class="border rounded p-2 w-full mb-4">
      <button id="submit-login-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full">Login</button>
    </div>
  </div>

  <!-- Modal Notifikasi -->
  <div id="custom-alert-modal" class="modal">
    <div class="modal-content">
        <span id="close-alert-btn" class="close-btn">&times;</span>
        <p id="alert-message" class="my-4 text-lg text-gray-700"></p>
        <button id="alert-ok-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">OK</button>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBV551MYO9nH_aP9BLVPjJXmjTnf2S54-E",
    authDomain: "website-final-a1a4a.firebaseapp.com",
    projectId: "website-final-a1a4a",
    storageBucket: "website-final-a1a4a.appspot.com",
    messagingSenderId: "405433735027",
    appId: "1:405433735027:web:476c747f24a9e1e1d31706"
  };
  
  let app, auth, db, userId = null, blogCollectionRef = null;

  try {
      app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);
      blogCollectionRef = collection(db, `public/data/BlogPosts`);
  } catch (e) {
      console.error("Error initializing Firebase:", e);
      customAlert("Gagal menginisialisasi aplikasi. Periksa firebaseConfig Anda.");
  }

  // Elemen DOM
  const loginBtn = document.getElementById("login-btn");
  const logoutBtn = document.getElementById("logout-btn");
  const userInfo = document.getElementById("user-info");
  const userEmailDisplay = document.getElementById("user-email-display");
  const blogFormContainer = document.getElementById("blog-form-container");
  const blogPosts = document.getElementById("blog-posts");
  const submitBlogBtn = document.getElementById("submit-blog");
  const blogTitleInput = document.getElementById("blog-title");
  const blogContentInput = document.getElementById("blog-content");

  // Elemen Modal Login
  const loginModal = document.getElementById('login-modal');
  const closeLoginModalBtn = document.getElementById('close-login-modal-btn');
  const submitLoginBtn = document.getElementById('submit-login-btn');
  const emailInput = document.getElementById('email-input');
  const passwordInput = document.getElementById('password-input');
  const loginError = document.getElementById('login-error');

  // Elemen Modal Notifikasi
  const customAlertModal = document.getElementById('custom-alert-modal');
  const alertMessage = document.getElementById('alert-message');
  const closeAlertBtn = document.getElementById('close-alert-btn');
  const alertOkBtn = document.getElementById('alert-ok-btn');

  function customAlert(message) {
      alertMessage.textContent = message;
      customAlertModal.style.display = 'flex';
  }

  closeAlertBtn.onclick = () => customAlertModal.style.display = 'none';
  alertOkBtn.onclick = () => customAlertModal.style.display = 'none';

  // Fungsi Modal Login
  loginBtn.onclick = () => loginModal.style.display = 'flex';
  closeLoginModalBtn.onclick = () => loginModal.style.display = 'none';
  window.onclick = (event) => {
      if (event.target == loginModal || event.target == customAlertModal) {
          loginModal.style.display = 'none';
          customAlertModal.style.display = 'none';
      }
  };

  // Proses Login
  submitLoginBtn.addEventListener('click', async () => {
    const email = emailInput.value;
    const password = passwordInput.value;
    loginError.classList.add('hidden');

    try {
        await signInWithEmailAndPassword(auth, email, password);
        loginModal.style.display = 'none';
        emailInput.value = '';
        passwordInput.value = '';
    } catch (error) {
        console.error("Login failed:", error);
        loginError.textContent = "Email atau password salah.";
        loginError.classList.remove('hidden');
    }
  });

  // Listener Status Autentikasi
  onAuthStateChanged(auth, (user) => {
    // Render ulang blog setiap kali status login berubah
    // Ini memastikan tombol hapus muncul/hilang dengan benar
    setupBlogListener(); 
    
    if (user) {
      userId = user.uid;
      userInfo.classList.remove("hidden");
      userInfo.classList.add("flex");
      loginBtn.classList.add("hidden");
      userEmailDisplay.textContent = user.email;
      blogFormContainer.classList.remove("hidden");
    } else {
      userId = null;
      userInfo.classList.add("hidden");
      loginBtn.classList.remove("hidden");
      blogFormContainer.classList.add("hidden");
    }
  });

  // Logout
  logoutBtn.addEventListener("click", async () => {
    try {
      await signOut(auth);
    } catch (error) {
      console.error("Sign out failed:", error);
      customAlert("Gagal keluar: " + error.message);
    }
  });

  // Fungsi Blog
  function setupBlogListener() {
    const q = query(blogCollectionRef);
    onSnapshot(q, (snapshot) => {
      blogPosts.innerHTML = "";
      if (snapshot.empty) {
        blogPosts.innerHTML = '<p class="text-center text-gray-500">Belum ada postingan.</p>';
        return;
      }
      let posts = [];
      snapshot.forEach(doc => posts.push({ id: doc.id, ...doc.data() }));
      posts.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
      posts.forEach(post => blogPosts.appendChild(createPostElement(post)));
    }, (error) => {
      console.error("Error fetching blog posts:", error);
      blogPosts.innerHTML = '<p class="text-center text-red-500">Gagal memuat postingan. Periksa Aturan Keamanan (Security Rules) di Firebase.</p>';
    });
  }

  function createPostElement(post) {
    const div = document.createElement("div");
    div.className = "blog-post bg-white p-6 rounded-lg shadow-md";
    const authorText = post.authorEmail || 'Admin';
    const timestamp = post.createdAt ? new Date(post.createdAt.seconds * 1000).toLocaleString("id-ID") : "Baru saja";

    div.innerHTML = `
      <h4 class="text-xl font-bold text-gray-800 mb-2">${post.title}</h4>
      <p class="blog-content text-gray-600 mb-4">${post.content}</p>
      <div class="text-xs text-gray-400 border-t pt-2 flex justify-between items-center">
        <span>Oleh: ${authorText}</span>
        <span>${timestamp}</span>
      </div>
    `;

    // Hanya tampilkan tombol hapus jika user sudah login DAN user adalah pembuat post
    if (userId && post.authorId === userId) {
      const deleteButton = document.createElement("button");
      deleteButton.textContent = "Hapus";
      deleteButton.className = "bg-red-100 text-red-600 hover:bg-red-200 px-3 py-1 rounded-md text-xs font-semibold transition-colors mt-2";
      deleteButton.onclick = async () => {
        if (confirm("Apakah Anda yakin ingin menghapus postingan ini?")) {
            try {
                await deleteDoc(doc(db, `public/data/BlogPosts`, post.id));
            } catch (err) {
                console.error("Error deleting post: ", err);
                customAlert("Gagal menghapus postingan.");
            }
        }
      };
      div.appendChild(deleteButton);
    }
    return div;
  }

  submitBlogBtn.addEventListener("click", async () => {
    if (!auth.currentUser) {
      customAlert("Anda harus masuk untuk membuat postingan.");
      return;
    }
    const title = blogTitleInput.value.trim();
    const content = blogContentInput.value.trim();
    if (!title || !content) {
      customAlert("Judul dan konten tidak boleh kosong!");
      return;
    }
    try {
      await addDoc(blogCollectionRef, {
        title,
        content,
        authorId: auth.currentUser.uid,
        authorEmail: auth.currentUser.email,
        createdAt: serverTimestamp()
      });
      blogTitleInput.value = "";
      blogContentInput.value = "";
    } catch (err) {
      console.error("Error adding post:", err);
      customAlert("Gagal mengirim postingan.");
    }
  });

</script>

<script>
    // Skrip navigasi (tidak berubah)
    const sections = document.querySelectorAll('.section');
    const navLinks = document.querySelectorAll('.nav-link');
    window.showSection = function(id) { 
        sections.forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('onclick').includes(`'${id}'`)) {
            link.classList.add('active');
            }
        });
    }

    const infoTabContents = document.querySelectorAll('.info-tab-content');
    const infoTabLinks = document.querySelectorAll('.info-tab-link');
    window.showInfoTab = function(id) { 
        infoTabContents.forEach(content => content.classList.remove('active'));
        const activeContent = document.getElementById(id);
        if (activeContent) {
            activeContent.classList.add('active');
        }
        infoTabLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('onclick').includes(`'${id}'`)) {
                link.classList.add('active');
            }
        });
    }
    
    window.onload = () => { 
        showSection('beranda'); 
        showInfoTab('struktur');
    };
</script>
</body>
</html>
